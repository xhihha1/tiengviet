<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ðŸ“± iOS å…¨èž¢å¹•æ”¯æ´ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="è¶Šå—èªžå­¸ç¿’">

  <!-- âœ… Android Chrome å…¨èž¢å¹•æ”¯æ´ -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#ffffff">

  <!-- Optional: å¯ä»¥åŠ å…¥è‡ªè¨‚ icon -->
  <link rel="apple-touch-icon" href="icon-512.png">
  <!-- favicon fallback -->
  <link rel="icon" type="image/png" href="icon-512.png">
  <title>Language Selection</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="common.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  <style>

  </style>
</head>

<body>
  <!-- æœå°‹æ¬„ä½ -->
  <div class="search-container">
    <div class="search-wrapper">
      <input type="text" id="searchInput" placeholder="æœå°‹è¶Šå—èªžã€ä¸­æ–‡æˆ–è‹±æ–‡...">
      <button id="clearSearch" class="clear-button"><i class="fa-solid fa-xmark"></i></button>
      <button id="sortBtn" class="sort-button">
        <i class="fa-solid fa-arrow-down-a-z"></i>
      </button>
    </div>
  </div>
  <ul class="word-list" id="wordList">
  </ul>

  <!-- æ·»åŠ åº•éƒ¨å°Žèˆªæ¬„ -->
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item active">
      <i class="fa-solid fa-list"></i>
      <span>List</span>
    </a>
    <a href="exam.html" class="nav-item">
      <i class="fa-solid fa-graduation-cap"></i>
      <span>Exam</span>
    </a>
    <a href="more.html" class="nav-item">
      <i class="fa-solid fa-ellipsis"></i>
      <span>More</span>
    </a>
  </nav>
  <script>
    function toggleVoice() {
      const voices = speechSynthesis.getVoices();
      const viVoice = voices.find(v => v.lang === 'vi-VN');

      document.querySelectorAll('.voice').forEach(button => {
        button.addEventListener('click', function () {
          const li = this.closest('li.word-item');
          const text = li.querySelector('h3.vn').textContent.trim();

          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = 'vi-VN';
          if (viVoice) utterance.voice = viVoice;

          speechSynthesis.speak(utterance);
        });
      });

      document.querySelectorAll('.sentence').forEach(button => {
        button.addEventListener('click', function () {
          const text = this.textContent.trim();

          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = 'vi-VN';
          if (viVoice) utterance.voice = viVoice;

          speechSynthesis.speak(utterance);
        });
      });
    }


    // å‹•æ…‹è¼‰å…¥ lang.json ä¸¦ç”Ÿæˆ li
    fetch('lang.json')
      .then(response => response.json())
      .then(data => {
        const wordList = document.getElementById('wordList');
        originalOrder = data.map(word => ({ // å„²å­˜åŽŸå§‹è³‡æ–™è€Œä¸æ˜¯DOMå…ƒç´ 
          vn: word.vn,
          zh: word.zh,
          en: word.en,
          sentence: word.sentence,
          translation: word.translation
        }));

        data.forEach(word => {
          const li = document.createElement('li');
          li.classList.add('word-item');

          li.innerHTML = `
          <button class="voice"><i class="fa-solid fa-volume-high"></i></button>
          <div class="word-content">
            <div class="row">
              <h3 class="vn">${word.vn}</h3>
              <p class="zh">${word.zh}</p>
              <p class="en">${word.en}</p>
            </div>
            <div class="row">
              <p class="sentence">${word.sentence}</p>
              <p class="translation">${word.translation}</p>
            </div>
          </div>
        `;

          wordList.appendChild(li);
        });

        if (typeof speechSynthesis !== 'undefined') {
          if (speechSynthesis.getVoices().length === 0) {
            speechSynthesis.addEventListener('voiceschanged', toggleVoice);
          } else {
            toggleVoice();
          }
        }
      })
      .catch(error => console.error('Error loading lang.json:', error));




    // Search functionality
    const searchInput = document.getElementById('searchInput');
    const clearButton = document.getElementById('clearSearch');

    // Show/hide clear button based on input content
    searchInput.addEventListener('input', function () {
      clearButton.style.display = this.value ? 'block' : 'none';
      const searchTerm = this.value.toLowerCase();
      const listItems = document.querySelectorAll('.word-item');

      listItems.forEach(item => {
        const vn = item.querySelector('h3.vn').textContent.toLowerCase();
        const zh = item.querySelector('p.zh').textContent.toLowerCase();
        const en = item.querySelector('p.en').textContent.toLowerCase();

        const matched = vn.includes(searchTerm) || zh.includes(searchTerm) || en.includes(searchTerm);

        item.style.display = matched ? 'block' : 'none';
      });
    });

    // Clear input when button is clicked
    clearButton.addEventListener('click', function() {
      searchInput.value = '';
      clearButton.style.display = 'none';
      // Trigger input event to update search results
      searchInput.dispatchEvent(new Event('input'));
    });

    // Add sorting functionality
    let sortState = 0; // 0: åŽŸåº, 1: å‡åº, 2: é™åº
    let originalOrder = []; // ç§»åˆ°å…¨åŸŸè®Šæ•¸
    const sortBtn = document.getElementById('sortBtn');
    
    sortBtn.addEventListener('click', function() {
      sortState = (sortState + 1) % 3;
      
      // æ›´æ–°æŒ‰éˆ•åœ–æ¨™
      const icon = sortBtn.querySelector('i');
      icon.className = sortState === 0 
        ? 'fa-solid fa-bars' 
        : sortState === 1 
          ? 'fa-solid fa-arrow-down-a-z' 
          : 'fa-solid fa-arrow-up-z-a';
      
      const wordList = document.getElementById('wordList');
      
      if (sortState === 0) {
        // æ¢å¾©åŽŸåº
        wordList.innerHTML = '';
        originalOrder.forEach(word => {
          const li = document.createElement('li');
          li.classList.add('word-item');
          li.innerHTML = `
            <button class="voice"><i class="fa-solid fa-volume-high"></i></button>
            <div class="word-content">
              <div class="row">
                <h3 class="vn">${word.vn}</h3>
                <p class="zh">${word.zh}</p>
                <p class="en">${word.en}</p>
              </div>
              <div class="row">
                <p class="sentence">${word.sentence}</p>
                <p class="translation">${word.translation}</p>
              </div>
            </div>
          `;
          wordList.appendChild(li);
        });
        toggleVoice(); // é‡æ–°ç¶å®šèªžéŸ³äº‹ä»¶
      } else {
        // æŽ’åº
        const wordItems = Array.from(document.querySelectorAll('.word-item'));
        wordItems.sort((a, b) => {
          const textA = a.querySelector('h3.vn').textContent.toLowerCase();
          const textB = b.querySelector('h3.vn').textContent.toLowerCase();
          return sortState === 1 
            ? textA.localeCompare(textB) 
            : textB.localeCompare(textA);
        });
        
        wordList.innerHTML = '';
        wordItems.forEach(item => wordList.appendChild(item));
      }
    });
  </script>
</body>

</html>