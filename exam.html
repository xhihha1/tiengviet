<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ğŸ“± iOS å…¨è¢å¹•æ”¯æ´ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="è¶Šå—èªå­¸ç¿’">

  <!-- âœ… Android Chrome å…¨è¢å¹•æ”¯æ´ -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#ffffff">

  <!-- Optional: å¯ä»¥åŠ å…¥è‡ªè¨‚ icon -->
  <link rel="apple-touch-icon" href="icon-512.png">
  <!-- favicon fallback -->
  <link rel="icon" type="image/png" href="icon-512.png">
  <title>Language Selection</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="common.css">
  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .word-container {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 80px;
    }

    .vn-word {
      font-size: 2rem;
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    .voice-btn {
      background: none;
      border: none;
      color: #3498db;
      font-size: 1.5rem;
      cursor: pointer;
      margin-left: 10px;
      vertical-align: middle;
    }

    .options-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
    }

    @media (min-width: 600px) {
      .options-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .option-btn {
      padding: 15px;
      border: 2px solid #3498db;
      border-radius: 8px;
      background-color: white;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
    }

    .option-btn:hover {
      background-color: #f0f8ff;
    }

    .option-btn.correct {
      background-color: #2ecc71;
      color: white;
      border-color: #27ae60;
    }

    .option-btn.incorrect {
      background-color: #e74c3c;
      color: white;
      border-color: #c0392b;
    }

    .zh-text {
      font-size: 1.2rem;
      margin-bottom: 5px;
    }

    .en-text {
      font-size: 0.9rem;
      color: #7f8c8d;
    }

    .option-btn.correct .en-text,
    .option-btn.incorrect .en-text {
      color: rgba(255, 255, 255, 0.8);
    }

    .next-btn {
      display: block;
      margin: 30px auto 0;
      padding: 12px 25px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .next-btn:hover {
      background-color: #2980b9;
    }

    .feedback {
      text-align: center;
      margin-top: 20px;
      font-size: 1.1rem;
      min-height: 25px;
    }

    .try-again {
      color: #e74c3c;
    }

    .example-sentence {
      margin-top: 30px;
      padding: 15px;
      background-color: #eaf7fd;
      border-radius: 8px;
      font-style: italic;
    }

    .sentence-vn {
      margin-bottom: 10px;
    }

    .sentence-translation {
      color: #7f8c8d;
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>è¶Šå—èªå–®å­—ç·´ç¿’</h1>
  </div>

  <div class="word-container">
    <div class="vn-word">
      <span id="current-word"></span>
      <button class="voice-btn" id="voice-btn">
        <i class="fas fa-volume-high"></i>
      </button>
    </div>

    <div class="options-container" id="options-container">
      <!-- é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
    </div>

    <div class="feedback" id="feedback"></div>

    <button class="next-btn" id="next-btn" style="display: none;">Next</button>

    <div class="example-sentence" id="example-sentence" style="display: none;">
      <div class="sentence-vn" id="sentence-vn"></div>
      <div class="sentence-translation" id="sentence-translation"></div>
    </div>
  </div>

  <script>
    // ç¤ºä¾‹æ•¸æ“š - å¯¦éš›ä½¿ç”¨æ™‚æ‡‰è©²å¾lang.jsonåŠ è¼‰
    let wordList = [];
    // let wordList = [
    //     {
    //         "vn": "trÆ°á»Ÿng thÃ nh",
    //         "zh": "æˆç†Ÿçš„ã€æˆå¹´çš„",
    //         "en": "mature, adult",
    //         "sentence": "Anh áº¥y ráº¥t trÆ°á»Ÿng thÃ nh trong cÃ¡ch suy nghÄ©.",
    //         "translation": "ä»–çš„æƒ³æ³•éå¸¸æˆç†Ÿã€‚"
    //     },
    //     {
    //         "vn": "tiá»‡n lá»£i",
    //         "zh": "ä¾¿åˆ©çš„",
    //         "en": "convenient",
    //         "sentence": "Cá»­a hÃ ng nÃ y ráº¥t tiá»‡n lá»£i vÃ¬ gáº§n nhÃ  tÃ´i.",
    //         "translation": "é€™å®¶åº—å¾ˆæ–¹ä¾¿ï¼Œå› ç‚ºé è¿‘æˆ‘å®¶ã€‚"
    //     },
    //     {
    //         "vn": "xinh Ä‘áº¹p",
    //         "zh": "ç¾éº—çš„",
    //         "en": "beautiful",
    //         "sentence": "CÃ´ áº¥y ráº¥t xinh Ä‘áº¹p vÃ  thÃ´ng minh.",
    //         "translation": "å¥¹æ—¢ç¾éº—åˆè°æ˜ã€‚"
    //     },
    //     {
    //         "vn": "thÃ´ng minh",
    //         "zh": "è°æ˜çš„",
    //         "en": "intelligent",
    //         "sentence": "Äá»©a bÃ© nÃ y ráº¥t thÃ´ng minh.",
    //         "translation": "é€™å€‹å°å­©å¾ˆè°æ˜ã€‚"
    //     },
    //     {
    //         "vn": "vui váº»",
    //         "zh": "å¿«æ¨‚çš„",
    //         "en": "happy, cheerful",
    //         "sentence": "Má»i ngÆ°á»i Ä‘á»u vui váº» trong bá»¯a tiá»‡c.",
    //         "translation": "æ¯å€‹äººåœ¨æ´¾å°ä¸Šéƒ½å¾ˆå¿«æ¨‚ã€‚"
    //     }
    // ];

    // å¯¦éš›æ‡‰ç”¨ä¸­æ‡‰è©²ä½¿ç”¨fetchåŠ è¼‰JSONæ–‡ä»¶

    fetch('lang.json')
      .then(response => response.json())
      .then(data => {
        wordList = data;
        initApp();
      })
      .catch(error => console.error('Error loading word list:', error));


    let currentWord = null;
    let correctAnswer = null;
    let selectedOption = null;
    let options = [];
    let isAnswered = false;

    // åˆå§‹åŒ–æ‡‰ç”¨
    function initApp() {
      if (wordList.length < 4) {
        console.error('éœ€è¦è‡³å°‘3å€‹å–®å­—æ‰èƒ½é€²è¡Œç·´ç¿’');
        return;
      }

      nextWord();

      // èªéŸ³æŒ‰éˆ•äº‹ä»¶
      document.getElementById('voice-btn').addEventListener('click', speakWord);

      // NextæŒ‰éˆ•äº‹ä»¶
      document.getElementById('next-btn').addEventListener('click', nextWord);
    }

    // ç²å–ä¸‹ä¸€å€‹å–®å­—
    function nextWord() {
      // é‡ç½®ç‹€æ…‹
      document.getElementById('feedback').textContent = '';
      document.getElementById('next-btn').style.display = 'none';
      document.getElementById('example-sentence').style.display = 'none';
      selectedOption = null;
      isAnswered = false;

      // éš¨æ©Ÿé¸æ“‡ç•¶å‰å–®å­—
      const randomIndex = Math.floor(Math.random() * wordList.length);
      currentWord = wordList[randomIndex];

      // é¡¯ç¤ºç•¶å‰å–®å­—
      document.getElementById('current-word').textContent = currentWord.vn;

      // ç”Ÿæˆé¸é …
      generateOptions(currentWord);
    }

    // ç”Ÿæˆé¸é …
    function generateOptions(correctWord) {
      const optionsContainer = document.getElementById('options-container');
      optionsContainer.innerHTML = '';

      // æ”¶é›†æ‰€æœ‰å¯èƒ½çš„é¸é …ï¼ˆé™¤äº†æ­£ç¢ºç­”æ¡ˆï¼‰
      const otherWords = wordList.filter(word => word.vn !== correctWord.vn);

      // éš¨æ©Ÿé¸æ“‡2å€‹éŒ¯èª¤é¸é …
      const wrongOptions = [];
      while (wrongOptions.length < 3 && otherWords.length > 0) {
        const randomIndex = Math.floor(Math.random() * otherWords.length);
        wrongOptions.push(otherWords[randomIndex]);
        otherWords.splice(randomIndex, 1);
      }

      // å‰µå»ºé¸é …æ•¸çµ„ï¼ˆ1æ­£ç¢º + 2éŒ¯èª¤ï¼‰
      options = [correctWord, ...wrongOptions];

      // æ‰“äº‚é¸é …é †åº
      options.sort(() => Math.random() - 0.5);

      // è¨˜éŒ„æ­£ç¢ºç­”æ¡ˆçš„ç´¢å¼•
      correctAnswer = options.findIndex(option => option.vn === correctWord.vn);

      // ç”Ÿæˆé¸é …æŒ‰éˆ•
      options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'option-btn';
        button.innerHTML = `
                    <div class="zh-text">${option.zh}</div>
                    <div class="en-text">${option.en}</div>
                `;

        button.addEventListener('click', () => selectOption(index));
        optionsContainer.appendChild(button);
      });
    }

    // é¸æ“‡é¸é …
    function selectOption(index) {
      if (isAnswered) return; // é˜²æ­¢å·²å›ç­”å¾Œå†æ¬¡é¸æ“‡

      isAnswered = true;
      selectedOption = index;
      const buttons = document.querySelectorAll('.option-btn');
      const feedback = document.getElementById('feedback');

      if (index === correctAnswer) {
        // æ­£ç¢ºç­”æ¡ˆ
        buttons[index].classList.add('correct');
        feedback.textContent = 'æ­£ç¢º!';
        feedback.style.color = '#2ecc71';

        // é¡¯ç¤ºä¾‹å¥
        document.getElementById('sentence-vn').textContent = currentWord.sentence;
        document.getElementById('sentence-translation').textContent = currentWord.translation;
        document.getElementById('example-sentence').style.display = 'block';

        // é¡¯ç¤ºNextæŒ‰éˆ•
        document.getElementById('next-btn').style.display = 'block';
      } else {
        // éŒ¯èª¤ç­”æ¡ˆ
        buttons[index].classList.add('incorrect');
        buttons[correctAnswer].classList.add('correct');
        feedback.textContent = 'ä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡';
        feedback.style.color = '#e74c3c';
        feedback.classList.add('try-again');

        // é¡¯ç¤ºNextæŒ‰éˆ•ï¼ˆå³ä½¿ç­”éŒ¯ä¹Ÿå…è¨±ç¹¼çºŒï¼‰
        document.getElementById('next-btn').style.display = 'block';
      }
    }

    // èªéŸ³æœ—è®€
    function speakWord() {
      if (!currentWord) return;

      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(currentWord.vn);
        utterance.lang = 'vi-VN'; // è¨­ç½®ç‚ºè¶Šå—èª
        speechSynthesis.speak(utterance);
      } else {
        alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒèªéŸ³åˆæˆåŠŸèƒ½');
      }
    }

    // åˆå§‹åŒ–æ‡‰ç”¨
    // document.addEventListener('DOMContentLoaded', initApp);
  </script>
  <!-- æ·»åŠ åº•éƒ¨å°èˆªæ¬„ -->
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item">
      <i class="fa-solid fa-list"></i>
      <span>List</span>
    </a>
    <a href="exam.html" class="nav-item active">
      <i class="fa-solid fa-graduation-cap"></i>
      <span>Exam</span>
    </a>
  </nav>
</body>

</html>